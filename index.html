<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pigello - Fastighetsförvaltning</title>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    :root {
      /* Core palette */
      --bg-primary: #fafbfc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f4f6f8;
      --bg-elevated: #ffffff;

      /* Text */
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-tertiary: #94a3b8;
      --text-muted: #cbd5e1;

      /* Borders */
      --border-subtle: #f1f5f9;
      --border-default: #e2e8f0;
      --border-strong: #cbd5e1;

      /* Brand - muted blue-gray for legacy look */
      --brand-primary: #4A7C94;
      --brand-secondary: #6B9AAD;
      --brand-tertiary: #8DB3C3;
      --brand-bg: #E8EEF1;

      /* Status */
      --success: #10b981;
      --success-bg: #ecfdf5;
      --warning: #f59e0b;
      --warning-bg: #fffbeb;
      --error: #ef4444;
      --error-bg: #fef2f2;
      --info: #3b82f6;
      --info-bg: #eff6ff;

      /* Shadows */
      --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 10px 10px -5px rgba(0, 0, 0, 0.03);

      /* Animation */
      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);

      /* Spacing */
      --sidebar-width: 280px;
      --topbar-height: 72px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* ==================== LAYOUT ==================== */
    .app {
      display: flex;
      min-height: 100vh;
    }

    /* ==================== SIDEBAR ==================== */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      z-index: 100;
      transition: transform 0.3s var(--ease-out);
    }

    .sidebar-header {
      padding: 24px 28px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      cursor: pointer;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: #5a6a72;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 0;
    }

    .logo:hover .logo-icon {
      background: #4a5a62;
    }

    .logo-text {
      font-size: 18px;
      font-weight: 600;
      color: #374151;
      letter-spacing: 0;
    }

    .sidebar-nav {
      flex: 1;
      padding: 20px 16px;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 28px;
    }

    .nav-section-title {
      font-size: 10px;
      font-weight: 700;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0 12px;
      margin-bottom: 10px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 3px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.1s;
      cursor: pointer;
      position: relative;
      border-left: 2px solid transparent;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: #e5e7eb;
      color: #374151;
      border-left-color: #6b7280;
    }

    .nav-item .icon {
      width: 20px;
      height: 20px;
      stroke-width: 1.75;
      flex-shrink: 0;
    }

    .nav-badge {
      margin-left: auto;
      font-size: 11px;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 20px;
      min-width: 24px;
      text-align: center;
    }

    .nav-badge.default {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .nav-badge.alert {
      background: #E5E7EB;
      color: #374151;
    }

    @keyframes pulse-badge {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .sidebar-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border-subtle);
    }

    .user-card {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 3px;
      cursor: pointer;
      transition: background 0.1s;
    }

    .user-card:hover {
      background: var(--bg-tertiary);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: #6b7280;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 13px;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .user-role {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    .user-dropdown-icon {
      width: 16px;
      height: 16px;
      color: var(--text-tertiary);
    }

    /* ==================== MAIN CONTENT ==================== */
    .main {
      flex: 1;
      margin-left: var(--sidebar-width);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      height: var(--topbar-height);
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(8px);
      background: rgba(255, 255, 255, 0.9);
    }

    .search-container {
      position: relative;
      width: 420px;
    }

    .search-box {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-primary);
      border: 1px solid var(--border-default);
      border-radius: 3px;
      padding: 8px 12px;
      width: 100%;
      transition: all 0.1s;
    }

    .search-box:focus-within {
      border-color: #6b7280;
      background: var(--bg-secondary);
    }

    .search-box .icon {
      width: 18px;
      height: 18px;
      color: var(--text-tertiary);
      flex-shrink: 0;
    }

    .search-box input {
      flex: 1;
      border: none;
      background: none;
      font-size: 14px;
      color: var(--text-primary);
      outline: none;
      font-family: inherit;
    }

    .search-box input::placeholder {
      color: var(--text-tertiary);
    }

    .search-shortcut {
      font-size: 11px;
      color: var(--text-tertiary);
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      padding: 3px 8px;
      border-radius: 6px;
      font-weight: 500;
    }

    .topbar-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .topbar-btn {
      width: 36px;
      height: 36px;
      border-radius: 3px;
      border: 1px solid var(--border-default);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s;
      position: relative;
    }

    .topbar-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .topbar-btn .icon {
      width: 20px;
      height: 20px;
      stroke-width: 1.75;
    }

    .notification-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 8px;
      height: 8px;
      background: var(--error);
      border-radius: 50%;
      border: 2px solid var(--bg-secondary);
    }

    /* ==================== PAGE CONTAINER ==================== */
    .page-container {
      flex: 1;
      padding: 32px 40px;
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
    }

    /* ==================== VIEWS ==================== */
    .view {
      display: none;
      animation: fadeIn 0.3s var(--ease-out);
    }

    .view.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ==================== PAGE HEADER ==================== */
    .page-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 32px;
    }

    .page-header-content h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.5px;
      margin-bottom: 4px;
    }

    .page-header-content p {
      font-size: 15px;
      color: var(--text-secondary);
    }

    .page-header-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .page-badge {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 20px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    /* ==================== STATS GRID ==================== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border-radius: 4px;
      padding: 16px 20px;
      border: 1px solid var(--border-default);
      transition: none;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      display: none;
    }

    .stat-card:hover {
      border-color: var(--border-strong);
    }

    .stat-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .stat-card-title {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .stat-card-icon {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f3f4f6;
      color: #6b7280;
      border: 1px solid #e5e7eb;
    }

    .stat-card-icon .icon {
      width: 18px;
      height: 18px;
      stroke-width: 1.75;
    }

    .stat-card-value {
      font-size: 28px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.5px;
      margin-bottom: 4px;
    }

    .stat-card-change {
      display: none;
    }

    .stat-card-change.positive {
      color: var(--text-secondary);
    }

    .stat-card-change.negative {
      color: var(--text-secondary);
    }

    .stat-card-change .icon {
      width: 14px;
      height: 14px;
    }

    /* Stat card color variants - all use gray now */
    .stat-card.blue,
    .stat-card.green,
    .stat-card.purple,
    .stat-card.orange {
      --stat-color: #6b7280;
      --stat-bg: #f3f4f6;
    }

    /* ==================== CARDS ==================== */
    .card {
      background: var(--bg-secondary);
      border-radius: 4px;
      border: 1px solid var(--border-default);
      overflow: hidden;
    }

    .card-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border-default);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f9fafb;
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    /* ==================== BUTTONS ==================== */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 3px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid;
      cursor: pointer;
      transition: all 0.1s;
      font-family: inherit;
    }

    .btn .icon {
      width: 16px;
      height: 16px;
      stroke-width: 2;
    }

    .btn-primary {
      background: #475569;
      color: white;
      border-color: #475569;
    }

    .btn-primary:hover {
      background: #334155;
      border-color: #334155;
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-secondary);
      border-color: var(--border-default);
    }

    .btn-secondary:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-color: var(--border-strong);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
      padding: 6px 10px;
      border-color: transparent;
    }

    .btn-ghost:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    /* ==================== TABLE ==================== */
    .table-container {
      overflow-x: auto;
      border: 1px solid var(--border-default);
      border-radius: 3px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th {
      text-align: left;
      padding: 10px 14px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      border: 1px solid var(--border-default);
      background: #f3f4f6;
    }

    .table td {
      padding: 10px 14px;
      font-size: 13px;
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
    }

    .table tbody tr {
      cursor: pointer;
    }

    .table tbody tr:hover td {
      background: #f9fafb;
    }

    /* ==================== CASE ROW ==================== */
    .case-row {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .case-icon {
      width: 36px;
      height: 36px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: #f3f4f6;
      color: #6b7280;
      border: 1px solid #e5e7eb;
    }

    .case-icon .icon {
      width: 18px;
      height: 18px;
      stroke-width: 1.75;
    }

    .case-icon.vvs,
    .case-icon.el,
    .case-icon.varme,
    .case-icon.las,
    .case-icon.ovrigt {
      background: #f3f4f6;
      color: #6b7280;
    }

    .case-info {
      flex: 1;
      min-width: 0;
    }

    .case-title {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
    }

    .case-meta {
      font-size: 13px;
      color: var(--text-tertiary);
    }

    /* ==================== PROPERTY ROW ==================== */
    .property-row {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .property-icon {
      width: 36px;
      height: 36px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: #f3f4f6;
      color: #6b7280;
      border: 1px solid #e5e7eb;
    }

    .property-icon .icon {
      width: 18px;
      height: 18px;
      stroke-width: 1.75;
    }

    .property-info {
      flex: 1;
      min-width: 0;
    }

    .property-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      background: #f3f4f6;
      color: #6b7280;
      border: 1px solid #e5e7eb;
    }

    .search-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .search-input-wrapper .search-icon {
      position: absolute;
      left: 12px;
      width: 16px;
      height: 16px;
      color: var(--text-tertiary);
      pointer-events: none;
    }

    .search-input {
      padding: 8px 12px 8px 36px;
      border: 1px solid var(--border-default);
      border-radius: 6px;
      font-size: 13px;
      width: 240px;
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--brand-primary);
    }

    .search-input::placeholder {
      color: var(--text-tertiary);
    }

    /* ==================== STATUS BADGES ==================== */
    .status {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
    }

    .status-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: currentColor;
    }

    .status.urgent {
      background: #FEE2E2;
      color: #991B1B;
    }

    .status.active {
      background: #E5E7EB;
      color: #374151;
    }

    .status.pending {
      background: #FEF3C7;
      color: #92400E;
    }

    .status.completed {
      background: #E5E7EB;
      color: #6B7280;
    }

    @keyframes pulse-dot {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
    }

    /* ==================== PRIORITY ==================== */
    .priority {
      font-size: 13px;
      font-weight: 500;
    }
    .priority.high { color: #374151; }
    .priority.medium { color: #6B7280; }
    .priority.low { color: #9CA3AF; }

    /* ==================== TENANT ==================== */
    .tenant {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tenant-avatar {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      background: #6B7280;
      color: #FFFFFF;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
    }

    .case-time {
      font-size: 13px;
      color: var(--text-tertiary);
    }

    /* ==================== FILTER BAR ==================== */
    .filter-bar {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .filter-tabs {
      display: flex;
      gap: 4px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: 10px;
    }

    .filter-tab {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.15s var(--ease-out);
    }

    .filter-tab:hover {
      color: var(--text-primary);
    }

    .filter-tab.active {
      background: var(--bg-secondary);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }

    .filter-separator {
      width: 1px;
      height: 24px;
      background: var(--border-default);
    }

    .filter-dropdown {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid var(--border-default);
      background: var(--bg-secondary);
      font-size: 13px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s var(--ease-out);
      font-family: inherit;
    }

    .filter-dropdown:hover {
      border-color: var(--border-strong);
      color: var(--text-primary);
    }

    .filter-dropdown .icon {
      width: 16px;
      height: 16px;
    }

    /* ==================== PAGINATION ==================== */
    .pagination {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-top: 1px solid var(--border-subtle);
    }

    .pagination-info {
      font-size: 13px;
      color: var(--text-tertiary);
    }

    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pagination-btn {
      width: 34px;
      height: 34px;
      border-radius: 8px;
      border: 1px solid var(--border-default);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s var(--ease-out);
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--bg-tertiary);
      border-color: var(--border-strong);
      color: var(--text-primary);
    }

    .pagination-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .pagination-btn .icon {
      width: 16px;
      height: 16px;
    }

    .pagination-pages {
      display: flex;
      gap: 4px;
    }

    .pagination-page {
      width: 34px;
      height: 34px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s var(--ease-out);
    }

    .pagination-page:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .pagination-page.active {
      background: var(--brand-primary);
      color: white;
    }

    /* ==================== CASE DETAIL VIEW ==================== */
    .case-detail-header {
      display: flex;
      gap: 24px;
      margin-bottom: 32px;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px 0;
      transition: color 0.15s;
      font-family: inherit;
    }

    .back-btn:hover {
      color: var(--text-primary);
    }

    .back-btn .icon {
      width: 18px;
      height: 18px;
    }

    .case-detail-grid {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 24px;
    }

    .case-main {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .case-sidebar {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* Info Card */
    .info-card {
      background: var(--bg-secondary);
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      padding: 24px;
    }

    .info-card-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-card-title .icon {
      width: 18px;
      height: 18px;
      color: var(--text-tertiary);
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .info-row:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .info-row:first-of-type {
      padding-top: 0;
    }

    .info-label {
      font-size: 13px;
      color: var(--text-tertiary);
    }

    .info-value {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Action Cards */
    .action-card {
      background: var(--bg-secondary);
      border-radius: 4px;
      border: 1px solid var(--border-default);
      overflow: hidden;
    }

    .action-card:hover {
      border-color: var(--border-strong);
    }

    .action-card-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      background: #f9fafb;
    }

    .action-card-header::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: #D1D5DB;
    }

    .action-card-icon {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f3f4f6;
      color: #6B7280;
      border: 1px solid #e5e7eb;
    }

    .action-card-icon .icon {
      width: 16px;
      height: 16px;
    }

    .action-card-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .action-card-body {
      padding: 16px;
    }

    /* All action cards use neutral gray */
    .action-card.green,
    .action-card.blue,
    .action-card.orange,
    .action-card.purple {
      --action-color: #6B7280;
      --action-bg: #f3f4f6;
    }

    /* Form Elements */
    .form-textarea {
      width: 100%;
      min-height: 100px;
      padding: 12px 14px;
      border: 1px solid var(--border-default);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      color: var(--text-primary);
      background: var(--bg-primary);
      resize: vertical;
      transition: all 0.1s;
      line-height: 1.5;
    }

    .form-textarea:focus {
      outline: none;
      border-color: #6b7280;
      background: var(--bg-secondary);
    }

    .form-textarea::placeholder {
      color: var(--text-tertiary);
    }

    .form-select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--border-default);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      color: var(--text-primary);
      background: var(--bg-primary);
      cursor: pointer;
      transition: all 0.1s;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 40px;
      margin-bottom: 12px;
    }

    .form-select:focus {
      outline: none;
      border-color: #6b7280;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 16px;
    }

    .btn-action {
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.15s var(--ease-out);
      font-family: inherit;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-action .icon {
      width: 16px;
      height: 16px;
    }

    .btn-action.primary {
      background: var(--action-color, var(--brand-primary));
      color: white;
    }

    .btn-action.primary:hover {
      filter: brightness(0.9);
      transform: translateY(-1px);
    }

    /* Timeline */
    .timeline {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .timeline-item {
      display: flex;
      gap: 16px;
      padding: 16px 0;
      position: relative;
    }

    .timeline-item:not(:last-child)::before {
      content: '';
      position: absolute;
      left: 19px;
      top: 44px;
      bottom: 0;
      width: 2px;
      background: var(--border-default);
    }

    .timeline-marker {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: #F3F4F6;
      color: #6B7280;
      border: 1px solid #E5E7EB;
    }

    .timeline-marker .icon {
      width: 18px;
      height: 18px;
    }

    /* All timeline markers use same muted gray */
    .timeline-marker.created,
    .timeline-marker.message,
    .timeline-marker.workorder,
    .timeline-marker.note {
      background: #F3F4F6;
      color: #6B7280;
    }

    .timeline-content {
      flex: 1;
      min-width: 0;
    }

    .timeline-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .timeline-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .timeline-time {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    .timeline-text {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Tenant Card */
    .tenant-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 0;
    }

    .tenant-card-avatar {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      background: #6B7280;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #FFFFFF;
      font-weight: 600;
      font-size: 16px;
    }

    .tenant-card-info {
      flex: 1;
    }

    .tenant-card-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
    }

    .tenant-card-contact {
      font-size: 13px;
      color: var(--text-tertiary);
    }

    .tenant-card-actions {
      display: flex;
      gap: 8px;
    }

    .tenant-action-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--border-default);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s var(--ease-out);
    }

    .tenant-action-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-color: var(--border-strong);
    }

    .tenant-action-btn .icon {
      width: 16px;
      height: 16px;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 1200px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .case-detail-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ==================== TOAST ==================== */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--text-primary);
      color: white;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow-xl);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s var(--ease-out);
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast .icon {
      width: 18px;
      height: 18px;
    }

    .toast.success {
      background: #059669;
    }

    .toast.error {
      background: #dc2626;
    }
  </style>
</head>
<body>

<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo" onclick="navigate('dashboard')">
        <div class="logo-icon">P</div>
        <span class="logo-text">Pigello</span>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Översikt</div>
        <div class="nav-item" data-view="dashboard" onclick="navigate('dashboard')">
          <i data-lucide="layout-dashboard" class="icon"></i>
          Dashboard
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Förvaltning</div>
        <div class="nav-item" data-view="properties" onclick="navigate('properties')">
          <i data-lucide="building-2" class="icon"></i>
          Fastigheter
          <span class="nav-badge default">24</span>
        </div>
        <div class="nav-item" onclick="showToast('Hyresgäster kommer snart', 'info')">
          <i data-lucide="users" class="icon"></i>
          Hyresgäster
          <span class="nav-badge default">847</span>
        </div>
        <div class="nav-item" data-view="cases" onclick="navigate('cases')">
          <i data-lucide="clipboard-list" class="icon"></i>
          Ärenden
          <span class="nav-badge alert">12</span>
        </div>
        <div class="nav-item" onclick="showToast('Avtal kommer snart', 'info')">
          <i data-lucide="file-text" class="icon"></i>
          Avtal
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Ekonomi</div>
        <div class="nav-item" onclick="showToast('Hyresavier kommer snart', 'info')">
          <i data-lucide="credit-card" class="icon"></i>
          Hyresavier
        </div>
        <div class="nav-item" onclick="showToast('Rapporter kommer snart', 'info')">
          <i data-lucide="bar-chart-3" class="icon"></i>
          Rapporter
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">System</div>
        <div class="nav-item" onclick="showToast('Inställningar kommer snart', 'info')">
          <i data-lucide="settings" class="icon"></i>
          Inställningar
        </div>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-card">
        <div class="user-avatar">ML</div>
        <div class="user-info">
          <div class="user-name">Maria Lindqvist</div>
          <div class="user-role">Förvaltare</div>
        </div>
        <i data-lucide="chevron-down" class="icon user-dropdown-icon"></i>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <header class="topbar">
      <div class="search-container">
        <div class="search-box">
          <i data-lucide="search" class="icon"></i>
          <input type="text" placeholder="Sök fastigheter, hyresgäster, ärenden...">
          <span class="search-shortcut">⌘K</span>
        </div>
      </div>
      <div class="topbar-actions">
        <button class="topbar-btn" onclick="showToast('3 nya notifikationer', 'info')">
          <i data-lucide="bell" class="icon"></i>
          <span class="notification-indicator"></span>
        </button>
        <button class="topbar-btn" onclick="showToast('Hjälp & Support', 'info')">
          <i data-lucide="help-circle" class="icon"></i>
        </button>
      </div>
    </header>

    <div class="page-container">
      <!-- Dashboard View -->
      <div id="view-dashboard" class="view active">
        <div class="page-header">
          <div class="page-header-content">
            <h1>Dashboard</h1>
            <p>Översikt av din fastighetsportfölj</p>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card blue">
            <div class="stat-card-header">
              <span class="stat-card-title">Fastigheter</span>
              <div class="stat-card-icon">
                <i data-lucide="building-2" class="icon"></i>
              </div>
            </div>
            <div class="stat-card-value">24</div>
            <div class="stat-card-change positive">
              <i data-lucide="trending-up" class="icon"></i>
              +2 denna månad
            </div>
          </div>

          <div class="stat-card green">
            <div class="stat-card-header">
              <span class="stat-card-title">Hyresintäkter</span>
              <div class="stat-card-icon">
                <i data-lucide="wallet" class="icon"></i>
              </div>
            </div>
            <div class="stat-card-value">4.2M kr</div>
            <div class="stat-card-change positive">
              <i data-lucide="trending-up" class="icon"></i>
              +8.2% vs förra året
            </div>
          </div>

          <div class="stat-card purple">
            <div class="stat-card-header">
              <span class="stat-card-title">Vakansgrad</span>
              <div class="stat-card-icon">
                <i data-lucide="home" class="icon"></i>
              </div>
            </div>
            <div class="stat-card-value">2.4%</div>
            <div class="stat-card-change positive">
              <i data-lucide="trending-down" class="icon"></i>
              -0.8% vs förra månaden
            </div>
          </div>

          <div class="stat-card orange">
            <div class="stat-card-header">
              <span class="stat-card-title">Öppna ärenden</span>
              <div class="stat-card-icon">
                <i data-lucide="clipboard-list" class="icon"></i>
              </div>
            </div>
            <div class="stat-card-value">12</div>
            <div class="stat-card-change negative">
              <i data-lucide="alert-circle" class="icon"></i>
              3 brådskande
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Senaste ärenden</h2>
            <button class="btn btn-secondary" onclick="navigate('cases')">
              Visa alla
              <i data-lucide="arrow-right" class="icon"></i>
            </button>
          </div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Ärende</th>
                  <th>Adress</th>
                  <th>Status</th>
                  <th>Prioritet</th>
                  <th>Skapad</th>
                </tr>
              </thead>
              <tbody>
                <tr onclick="navigate('case', '2024-0142')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon vvs"><i data-lucide="droplet" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Vattenläcka under diskbänk</div>
                        <div class="case-meta">VVS • #2024-0142</div>
                      </div>
                    </div>
                  </td>
                  <td>Storgatan 42, Lgh 1204</td>
                  <td><span class="status urgent"><span class="status-dot"></span>Brådskande</span></td>
                  <td><span class="priority high">Hög</span></td>
                  <td class="case-time">Idag 08:32</td>
                </tr>
                <tr onclick="navigate('case', '2024-0141')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon el"><i data-lucide="zap" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Trasigt vägguttag i sovrum</div>
                        <div class="case-meta">El • #2024-0141</div>
                      </div>
                    </div>
                  </td>
                  <td>Björkvägen 8, Lgh 302</td>
                  <td><span class="status active"><span class="status-dot"></span>Pågående</span></td>
                  <td><span class="priority medium">Medium</span></td>
                  <td class="case-time">Igår 14:20</td>
                </tr>
                <tr onclick="navigate('case', '2024-0140')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon varme"><i data-lucide="thermometer" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Elementen värmer inte</div>
                        <div class="case-meta">Värme • #2024-0140</div>
                      </div>
                    </div>
                  </td>
                  <td>Tallvägen 15, Lgh 501</td>
                  <td><span class="status urgent"><span class="status-dot"></span>Brådskande</span></td>
                  <td><span class="priority high">Hög</span></td>
                  <td class="case-time">Idag 06:15</td>
                </tr>
                <tr onclick="navigate('case', '2024-0139')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon las"><i data-lucide="key" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Ytterdörr går inte att låsa</div>
                        <div class="case-meta">Lås • #2024-0139</div>
                      </div>
                    </div>
                  </td>
                  <td>Ekgatan 22, Lgh 104</td>
                  <td><span class="status pending"><span class="status-dot"></span>Väntar</span></td>
                  <td><span class="priority medium">Medium</span></td>
                  <td class="case-time">Igår 09:45</td>
                </tr>
                <tr onclick="navigate('case', '2024-0138')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon ovrigt"><i data-lucide="wrench" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Balkongdörr kärvar</div>
                        <div class="case-meta">Övrigt • #2024-0138</div>
                      </div>
                    </div>
                  </td>
                  <td>Lindvägen 5, Lgh 203</td>
                  <td><span class="status completed"><span class="status-dot"></span>Åtgärdad</span></td>
                  <td><span class="priority low">Låg</span></td>
                  <td class="case-time">2024-01-13</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Cases List View -->
      <div id="view-cases" class="view">
        <div class="page-header">
          <div class="page-header-content">
            <h1>Ärenden</h1>
            <div class="page-header-meta">
              <span class="page-badge">12 öppna</span>
            </div>
          </div>
          <button class="btn btn-primary" onclick="showToast('Nytt ärende skapas...', 'success')">
            <i data-lucide="plus" class="icon"></i>
            Nytt ärende
          </button>
        </div>

        <div class="filter-bar">
          <div class="filter-tabs">
            <button class="filter-tab active">Alla</button>
            <button class="filter-tab">Brådskande</button>
            <button class="filter-tab">Pågående</button>
            <button class="filter-tab">Väntar</button>
            <button class="filter-tab">Åtgärdade</button>
          </div>
          <div class="filter-separator"></div>
          <button class="filter-dropdown">
            <i data-lucide="building-2" class="icon"></i>
            Alla fastigheter
            <i data-lucide="chevron-down" class="icon"></i>
          </button>
          <button class="filter-dropdown">
            <i data-lucide="tag" class="icon"></i>
            Alla kategorier
            <i data-lucide="chevron-down" class="icon"></i>
          </button>
        </div>

        <div class="card">
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Ärende</th>
                  <th>Hyresgäst</th>
                  <th>Adress</th>
                  <th>Status</th>
                  <th>Prioritet</th>
                  <th>Skapad</th>
                </tr>
              </thead>
              <tbody>
                <tr onclick="navigate('case', '2024-0142')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon vvs"><i data-lucide="droplet" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Vattenläcka under diskbänk</div>
                        <div class="case-meta">VVS • #2024-0142</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">AB</div><span>Anna Bergström</span></div></td>
                  <td>Storgatan 42, Lgh 1204</td>
                  <td><span class="status urgent"><span class="status-dot"></span>Brådskande</span></td>
                  <td><span class="priority high">Hög</span></td>
                  <td class="case-time">Idag 08:32</td>
                </tr>
                <tr onclick="navigate('case', '2024-0141')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon el"><i data-lucide="zap" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Trasigt vägguttag i sovrum</div>
                        <div class="case-meta">El • #2024-0141</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">KJ</div><span>Karl Johansson</span></div></td>
                  <td>Björkvägen 8, Lgh 302</td>
                  <td><span class="status active"><span class="status-dot"></span>Pågående</span></td>
                  <td><span class="priority medium">Medium</span></td>
                  <td class="case-time">Igår 14:20</td>
                </tr>
                <tr onclick="navigate('case', '2024-0140')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon varme"><i data-lucide="thermometer" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Elementen värmer inte</div>
                        <div class="case-meta">Värme • #2024-0140</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">ES</div><span>Erik Svensson</span></div></td>
                  <td>Tallvägen 15, Lgh 501</td>
                  <td><span class="status urgent"><span class="status-dot"></span>Brådskande</span></td>
                  <td><span class="priority high">Hög</span></td>
                  <td class="case-time">Idag 06:15</td>
                </tr>
                <tr onclick="navigate('case', '2024-0139')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon las"><i data-lucide="key" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Ytterdörr går inte att låsa</div>
                        <div class="case-meta">Lås • #2024-0139</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">MA</div><span>Maria Andersson</span></div></td>
                  <td>Ekgatan 22, Lgh 104</td>
                  <td><span class="status pending"><span class="status-dot"></span>Väntar</span></td>
                  <td><span class="priority medium">Medium</span></td>
                  <td class="case-time">Igår 09:45</td>
                </tr>
                <tr onclick="navigate('case', '2024-0138')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon ovrigt"><i data-lucide="wrench" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Balkongdörr kärvar</div>
                        <div class="case-meta">Övrigt • #2024-0138</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">PN</div><span>Per Nilsson</span></div></td>
                  <td>Lindvägen 5, Lgh 203</td>
                  <td><span class="status completed"><span class="status-dot"></span>Åtgärdad</span></td>
                  <td><span class="priority low">Låg</span></td>
                  <td class="case-time">2024-01-13</td>
                </tr>
                <tr onclick="navigate('case', '2024-0137')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon vvs"><i data-lucide="droplet" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Lågt vattentryck i duschen</div>
                        <div class="case-meta">VVS • #2024-0137</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">LG</div><span>Lisa Gustafsson</span></div></td>
                  <td>Granvägen 12, Lgh 401</td>
                  <td><span class="status active"><span class="status-dot"></span>Pågående</span></td>
                  <td><span class="priority low">Låg</span></td>
                  <td class="case-time">2024-01-12</td>
                </tr>
                <tr onclick="navigate('case', '2024-0136')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon el"><i data-lucide="zap" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Spisplatta fungerar ej</div>
                        <div class="case-meta">El • #2024-0136</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">OH</div><span>Olof Henriksson</span></div></td>
                  <td>Aspvägen 3, Lgh 102</td>
                  <td><span class="status pending"><span class="status-dot"></span>Väntar</span></td>
                  <td><span class="priority medium">Medium</span></td>
                  <td class="case-time">2024-01-11</td>
                </tr>
                <tr onclick="navigate('case', '2024-0135')">
                  <td>
                    <div class="case-row">
                      <div class="case-icon ovrigt"><i data-lucide="wrench" class="icon"></i></div>
                      <div class="case-info">
                        <div class="case-title">Kylskåp bullrar konstigt</div>
                        <div class="case-meta">Vitvaror • #2024-0135</div>
                      </div>
                    </div>
                  </td>
                  <td><div class="tenant"><div class="tenant-avatar">SP</div><span>Sara Pettersson</span></div></td>
                  <td>Almvägen 18, Lgh 605</td>
                  <td><span class="status completed"><span class="status-dot"></span>Åtgärdad</span></td>
                  <td><span class="priority low">Låg</span></td>
                  <td class="case-time">2024-01-10</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="pagination">
            <span class="pagination-info">Visar 1–8 av 12 ärenden</span>
            <div class="pagination-controls">
              <button class="pagination-btn" disabled><i data-lucide="chevron-left" class="icon"></i></button>
              <div class="pagination-pages">
                <button class="pagination-page active">1</button>
                <button class="pagination-page">2</button>
              </div>
              <button class="pagination-btn"><i data-lucide="chevron-right" class="icon"></i></button>
            </div>
          </div>
        </div>
      </div>

      <!-- Case Detail View -->
      <div id="view-case" class="view">
        <button class="back-btn" onclick="navigate('cases')">
          <i data-lucide="arrow-left" class="icon"></i>
          Tillbaka till ärenden
        </button>

        <div class="page-header" style="margin-top: 16px;">
          <div class="page-header-content">
            <h1 data-field="title">Vattenläcka under diskbänk</h1>
            <div class="page-header-meta">
              <span class="page-badge" data-field="id">#2024-0142</span>
              <span class="status urgent"><span class="status-dot"></span>Brådskande</span>
            </div>
          </div>
        </div>

        <div class="case-detail-grid">
          <div class="case-main">
            <!-- Action Cards for Rafter Testing -->
            <div class="action-card green">
              <div class="action-card-header">
                <div class="action-card-icon"><i data-lucide="file-text" class="icon"></i></div>
                <span class="action-card-title">Intern anteckning</span>
              </div>
              <div class="action-card-body">
                <textarea id="intern-anteckning" class="form-textarea" placeholder="Skriv en intern anteckning som endast syns för förvaltare..."></textarea>
                <div class="form-actions">
                  <button class="btn-action primary" onclick="saveNote()">
                    <i data-lucide="save" class="icon"></i>
                    Spara anteckning
                  </button>
                </div>
              </div>
            </div>

            <div class="action-card blue">
              <div class="action-card-header">
                <div class="action-card-icon"><i data-lucide="message-circle" class="icon"></i></div>
                <span class="action-card-title">Svar till hyresgäst</span>
              </div>
              <div class="action-card-body">
                <textarea id="svar-hyresgast" class="form-textarea" placeholder="Skriv ett meddelande till hyresgästen..."></textarea>
                <div class="form-actions">
                  <button class="btn-action primary" onclick="sendReply()">
                    <i data-lucide="send" class="icon"></i>
                    Skicka meddelande
                  </button>
                </div>
              </div>
            </div>

            <div class="action-card orange">
              <div class="action-card-header">
                <div class="action-card-icon"><i data-lucide="hammer" class="icon"></i></div>
                <span class="action-card-title">Arbetsorder</span>
              </div>
              <div class="action-card-body">
                <select id="entreprenor" class="form-select">
                  <option value="">Välj entreprenör...</option>
                  <option value="rorjouren">Rörjouren Stockholm AB</option>
                  <option value="vvs-teknik">VVS-Teknik & Service</option>
                  <option value="akut-ror">Akut Rör & Värme AB</option>
                </select>
                <textarea id="arbetsorder" class="form-textarea" placeholder="Beskriv arbetet som ska utföras..."></textarea>
                <div class="form-actions">
                  <button class="btn-action primary" onclick="sendWorkOrder()">
                    <i data-lucide="send" class="icon"></i>
                    Skicka arbetsorder
                  </button>
                </div>
              </div>
            </div>

            <div class="action-card purple">
              <div class="action-card-header">
                <div class="action-card-icon"><i data-lucide="check-circle" class="icon"></i></div>
                <span class="action-card-title">Avsluta ärende</span>
              </div>
              <div class="action-card-body">
                <textarea id="slutnotering" class="form-textarea" placeholder="Sammanfatta hur ärendet löstes..."></textarea>
                <div class="form-actions">
                  <button class="btn-action primary" onclick="closeCase()">
                    <i data-lucide="check" class="icon"></i>
                    Avsluta ärende
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="case-sidebar">
            <!-- Case Info -->
            <div class="info-card">
              <div class="info-card-title">
                <i data-lucide="info" class="icon"></i>
                Ärendeinfo
              </div>
              <div class="info-row">
                <span class="info-label">Ärendenummer</span>
                <span class="info-value" data-field="id">#2024-0142</span>
              </div>
              <div class="info-row">
                <span class="info-label">Kategori</span>
                <span class="info-value" data-field="category">VVS</span>
              </div>
              <div class="info-row">
                <span class="info-label">Prioritet</span>
                <span class="info-value priority high">Hög</span>
              </div>
              <div class="info-row">
                <span class="info-label">Skapad</span>
                <span class="info-value">2024-01-15 08:32</span>
              </div>
              <div class="info-row">
                <span class="info-label">Uppdaterad</span>
                <span class="info-value">2024-01-15 10:45</span>
              </div>
            </div>

            <!-- Tenant Info -->
            <div class="info-card">
              <div class="info-card-title">
                <i data-lucide="user" class="icon"></i>
                Hyresgäst
              </div>
              <div class="tenant-card">
                <div class="tenant-card-avatar">AB</div>
                <div class="tenant-card-info">
                  <div class="tenant-card-name" data-field="tenant">Anna Bergström</div>
                  <div class="tenant-card-contact">anna.bergstrom@email.se</div>
                </div>
                <div class="tenant-card-actions">
                  <button class="tenant-action-btn" onclick="showToast('Ringer Anna...', 'info')">
                    <i data-lucide="phone" class="icon"></i>
                  </button>
                  <button class="tenant-action-btn" onclick="showToast('Öppnar mail...', 'info')">
                    <i data-lucide="mail" class="icon"></i>
                  </button>
                </div>
              </div>
              <div class="info-row">
                <span class="info-label">Telefon</span>
                <span class="info-value">070-123 45 67</span>
              </div>
              <div class="info-row">
                <span class="info-label">Adress</span>
                <span class="info-value" data-field="address">Storgatan 42, Lgh 1204</span>
              </div>
            </div>

            <!-- Timeline -->
            <div class="info-card">
              <div class="info-card-title">
                <i data-lucide="clock" class="icon"></i>
                Historik
              </div>
              <div class="timeline" id="timeline">
                <div class="timeline-item">
                  <div class="timeline-marker message">
                    <i data-lucide="message-circle" class="icon"></i>
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-header">
                      <span class="timeline-title">Meddelande skickat</span>
                      <span class="timeline-time">10:45</span>
                    </div>
                    <div class="timeline-text">Svar skickat till hyresgäst om planerad åtgärd.</div>
                  </div>
                </div>
                <div class="timeline-item">
                  <div class="timeline-marker note">
                    <i data-lucide="file-text" class="icon"></i>
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-header">
                      <span class="timeline-title">Intern anteckning</span>
                      <span class="timeline-time">09:15</span>
                    </div>
                    <div class="timeline-text">Kontaktat Rörjouren, de kan komma imorgon fm.</div>
                  </div>
                </div>
                <div class="timeline-item">
                  <div class="timeline-marker created">
                    <i data-lucide="plus-circle" class="icon"></i>
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-header">
                      <span class="timeline-title">Ärende skapat</span>
                      <span class="timeline-time">08:32</span>
                    </div>
                    <div class="timeline-text">Felanmälan mottagen via Mina sidor.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Properties View -->
    <div id="view-properties" class="view">
      <div class="page-header">
        <div class="page-header-content">
          <h1>Fastigheter</h1>
          <div class="page-header-meta">
            <span class="page-badge">24 fastigheter</span>
          </div>
        </div>
        <button class="btn btn-secondary" onclick="showToast('Ny fastighet skapas...', 'info')">
          <i data-lucide="plus" class="icon"></i>
          Ny fastighet
        </button>
      </div>

      <div class="filter-bar">
        <div class="search-input-wrapper">
          <i data-lucide="search" class="icon search-icon"></i>
          <input type="text" class="search-input" placeholder="Sök fastigheter...">
        </div>
        <button class="filter-dropdown">
          <i data-lucide="map-pin" class="icon"></i>
          Alla områden
          <i data-lucide="chevron-down" class="icon"></i>
        </button>
      </div>

      <div class="card">
        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Fastighet</th>
                <th>Adress</th>
                <th>Lägenheter</th>
                <th>Vakansgrad</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div class="property-row">
                    <div class="property-icon"><i data-lucide="building" class="icon"></i></div>
                    <div class="property-info">
                      <div class="property-name">Björkvägen 8</div>
                    </div>
                  </div>
                </td>
                <td>Björkvägen 8, Stockholm</td>
                <td>12</td>
                <td>0%</td>
                <td><span class="status-pill">Aktiv</span></td>
              </tr>
              <tr>
                <td>
                  <div class="property-row">
                    <div class="property-icon"><i data-lucide="building" class="icon"></i></div>
                    <div class="property-info">
                      <div class="property-name">Storgatan 42</div>
                    </div>
                  </div>
                </td>
                <td>Storgatan 42, Stockholm</td>
                <td>24</td>
                <td>4.2%</td>
                <td><span class="status-pill">Aktiv</span></td>
              </tr>
              <tr>
                <td>
                  <div class="property-row">
                    <div class="property-icon"><i data-lucide="building" class="icon"></i></div>
                    <div class="property-info">
                      <div class="property-name">Tallvägen 15</div>
                    </div>
                  </div>
                </td>
                <td>Tallvägen 15, Solna</td>
                <td>8</td>
                <td>0%</td>
                <td><span class="status-pill">Aktiv</span></td>
              </tr>
              <tr>
                <td>
                  <div class="property-row">
                    <div class="property-icon"><i data-lucide="building" class="icon"></i></div>
                    <div class="property-info">
                      <div class="property-name">Ekgatan 22</div>
                    </div>
                  </div>
                </td>
                <td>Ekgatan 22, Stockholm</td>
                <td>16</td>
                <td>6.3%</td>
                <td><span class="status-pill">Aktiv</span></td>
              </tr>
              <tr>
                <td>
                  <div class="property-row">
                    <div class="property-icon"><i data-lucide="building" class="icon"></i></div>
                    <div class="property-info">
                      <div class="property-name">Lindvägen 5</div>
                    </div>
                  </div>
                </td>
                <td>Lindvägen 5, Sundbyberg</td>
                <td>6</td>
                <td>0%</td>
                <td><span class="status-pill">Aktiv</span></td>
              </tr>
              <tr>
                <td>
                  <div class="property-row">
                    <div class="property-icon"><i data-lucide="building" class="icon"></i></div>
                    <div class="property-info">
                      <div class="property-name">Granvägen 12</div>
                    </div>
                  </div>
                </td>
                <td>Granvägen 12, Stockholm</td>
                <td>18</td>
                <td>5.6%</td>
                <td><span class="status-pill">Aktiv</span></td>
              </tr>
              <tr>
                <td>
                  <div class="property-row">
                    <div class="property-icon"><i data-lucide="building" class="icon"></i></div>
                    <div class="property-info">
                      <div class="property-name">Aspvägen 3</div>
                    </div>
                  </div>
                </td>
                <td>Aspvägen 3, Solna</td>
                <td>10</td>
                <td>0%</td>
                <td><span class="status-pill">Aktiv</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Toast -->
<div id="toast" class="toast">
  <i data-lucide="check-circle" class="icon" id="toast-icon"></i>
  <span id="toast-message"></span>
</div>

<script>
  // ==================== CASE DATABASE ====================
  const casesDB = {
    '2024-0142': {
      id: '2024-0142',
      title: 'Vattenläcka under diskbänk',
      description: 'Hyresgästen rapporterar att det droppar vatten från röret under diskbänken i köket. Vattnet har börjat samlas på golvet och det luktar unket. Problemet upptäcktes igår kväll.',
      category: 'VVS',
      categoryIcon: 'droplet',
      categoryClass: 'vvs',
      status: 'urgent',
      statusText: 'Brådskande',
      priority: 'high',
      priorityText: 'Hög',
      address: 'Storgatan 42',
      apartment: 'Lgh 1204',
      tenant: {
        name: 'Anna Bergström',
        initials: 'AB',
        email: 'anna.bergstrom@email.se',
        phone: '070-123 45 67'
      },
      property: 'Fastighetshuset Centrum AB',
      createdAt: '2024-01-15 08:32',
      updatedAt: '2024-01-15 10:45',
      deadline: 24,
      assignedTo: 'Maria Lindqvist',
      contractors: [
        { value: 'rorjouren', name: 'Rörjouren Stockholm AB' },
        { value: 'vvs-teknik', name: 'VVS-Teknik & Service' },
        { value: 'akut-ror', name: 'Akut Rör & Värme AB' }
      ],
      timeline: [
        { type: 'message', title: 'Meddelande skickat', text: 'Svar skickat till hyresgäst om planerad åtgärd.', time: '10:45' },
        { type: 'note', title: 'Intern anteckning', text: 'Kontaktat Rörjouren, de kan komma imorgon fm.', time: '09:15' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan mottagen via Mina sidor.', time: '08:32' }
      ]
    },
    '2024-0141': {
      id: '2024-0141',
      title: 'Trasigt vägguttag i sovrum',
      description: 'Ett av vägguttagen i sovrummet har slutat fungera. Hyresgästen har testat med olika apparater och uttaget ger ingen ström. Säkringarna har kontrollerats och ser normala ut.',
      category: 'El',
      categoryIcon: 'zap',
      categoryClass: 'el',
      status: 'active',
      statusText: 'Pågående',
      priority: 'medium',
      priorityText: 'Medium',
      address: 'Björkvägen 8',
      apartment: 'Lgh 302',
      tenant: {
        name: 'Karl Johansson',
        initials: 'KJ',
        email: 'karl.johansson@gmail.com',
        phone: '073-456 78 90'
      },
      property: 'Bostadsbolaget Norr',
      createdAt: '2024-01-14 14:20',
      updatedAt: '2024-01-15 09:00',
      deadline: 48,
      assignedTo: 'Erik Svensson',
      contractors: [
        { value: 'eljouren', name: 'Eljouren 24/7' },
        { value: 'el-teknik', name: 'El-Teknik Stockholm' },
        { value: 'ljus-kraft', name: 'Ljus & Kraft AB' }
      ],
      timeline: [
        { type: 'note', title: 'Intern anteckning', text: 'Elektriker bokad för torsdag 10-12.', time: '09:00' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan via telefon.', time: '14:20' }
      ]
    },
    '2024-0140': {
      id: '2024-0140',
      title: 'Elementen värmer inte',
      description: 'Samtliga element i lägenheten är kalla trots att termostaten är inställd på max. Hyresgästen fryser och temperaturen i lägenheten är endast 16 grader. Problemet har pågått i två dagar.',
      category: 'Värme',
      categoryIcon: 'thermometer',
      categoryClass: 'varme',
      status: 'urgent',
      statusText: 'Brådskande',
      priority: 'high',
      priorityText: 'Hög',
      address: 'Tallvägen 15',
      apartment: 'Lgh 501',
      tenant: {
        name: 'Erik Svensson',
        initials: 'ES',
        email: 'erik.s@hotmail.com',
        phone: '076-234 56 78'
      },
      property: 'Fastighets AB Söder',
      createdAt: '2024-01-15 06:15',
      updatedAt: '2024-01-15 08:30',
      deadline: 12,
      assignedTo: 'Maria Lindqvist',
      contractors: [
        { value: 'varme-service', name: 'Värme & Service AB' },
        { value: 'vvs-teknik', name: 'VVS-Teknik & Service' },
        { value: 'energi-konsult', name: 'Energikonsulterna' }
      ],
      timeline: [
        { type: 'workorder', title: 'Arbetsorder skickad', text: 'Akut arbetsorder till Värme & Service AB.', time: '08:30' },
        { type: 'message', title: 'Meddelande skickat', text: 'Hyresgäst informerad om akut åtgärd idag.', time: '07:00' },
        { type: 'created', title: 'Ärende skapat', text: 'Akut felanmälan via telefon.', time: '06:15' }
      ]
    },
    '2024-0139': {
      id: '2024-0139',
      title: 'Ytterdörr går inte att låsa',
      description: 'Låset på ytterdörren har fastnat och går varken att låsa eller låsa upp ordentligt. Hyresgästen känner sig otrygg och vågar inte lämna lägenheten.',
      category: 'Lås',
      categoryIcon: 'key',
      categoryClass: 'las',
      status: 'pending',
      statusText: 'Väntar',
      priority: 'medium',
      priorityText: 'Medium',
      address: 'Ekgatan 22',
      apartment: 'Lgh 104',
      tenant: {
        name: 'Maria Andersson',
        initials: 'MA',
        email: 'maria.andersson@outlook.com',
        phone: '070-567 89 01'
      },
      property: 'Centrum Fastigheter AB',
      createdAt: '2024-01-14 09:45',
      updatedAt: '2024-01-14 11:00',
      deadline: 72,
      assignedTo: 'Johan Berg',
      contractors: [
        { value: 'las-nyckeln', name: 'Lås & Nyckeln AB' },
        { value: 'sakerhet-direkt', name: 'Säkerhet Direkt' },
        { value: 'smedjan', name: 'Låssmedjan Stockholm' }
      ],
      timeline: [
        { type: 'note', title: 'Intern anteckning', text: 'Väntar på återkoppling från Lås & Nyckeln.', time: '11:00' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan via Mina sidor.', time: '09:45' }
      ]
    },
    '2024-0138': {
      id: '2024-0138',
      title: 'Balkongdörr kärvar',
      description: 'Balkongdörren är svår att öppna och stänga. Den verkar ha satt sig något och skrapar i karmen. Problemet har förvärrats de senaste veckorna.',
      category: 'Övrigt',
      categoryIcon: 'wrench',
      categoryClass: 'ovrigt',
      status: 'completed',
      statusText: 'Åtgärdad',
      priority: 'low',
      priorityText: 'Låg',
      address: 'Lindvägen 5',
      apartment: 'Lgh 203',
      tenant: {
        name: 'Per Nilsson',
        initials: 'PN',
        email: 'per.nilsson@gmail.com',
        phone: '072-345 67 89'
      },
      property: 'Bostadsbolaget Norr',
      createdAt: '2024-01-10 15:30',
      updatedAt: '2024-01-13 14:00',
      deadline: 0,
      assignedTo: 'Erik Svensson',
      contractors: [
        { value: 'snickarn', name: 'Snickarn i Stockholm' },
        { value: 'dorrservice', name: 'Dörrservice AB' }
      ],
      timeline: [
        { type: 'closed', title: 'Ärende avslutat', text: 'Dörren justerad och fungerar nu korrekt.', time: '14:00' },
        { type: 'workorder', title: 'Arbetsorder skickad', text: 'Skickad till Snickarn i Stockholm.', time: '16:00' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan via email.', time: '15:30' }
      ]
    },
    '2024-0137': {
      id: '2024-0137',
      title: 'Lågt vattentryck i duschen',
      description: 'Vattentrycket i duschen har minskat kraftigt senaste veckan. Det tar mycket längre tid att tvätta håret och temperaturen varierar. Övriga kranar i lägenheten fungerar normalt.',
      category: 'VVS',
      categoryIcon: 'droplet',
      categoryClass: 'vvs',
      status: 'active',
      statusText: 'Pågående',
      priority: 'low',
      priorityText: 'Låg',
      address: 'Granvägen 12',
      apartment: 'Lgh 401',
      tenant: {
        name: 'Lisa Gustafsson',
        initials: 'LG',
        email: 'lisa.g@yahoo.se',
        phone: '073-678 90 12'
      },
      property: 'Fastighets AB Söder',
      createdAt: '2024-01-12 10:00',
      updatedAt: '2024-01-14 16:30',
      deadline: 96,
      assignedTo: 'Maria Lindqvist',
      contractors: [
        { value: 'rorjouren', name: 'Rörjouren Stockholm AB' },
        { value: 'vvs-teknik', name: 'VVS-Teknik & Service' }
      ],
      timeline: [
        { type: 'note', title: 'Intern anteckning', text: 'Troligtvis kalkavlagringar i duschmunstycket. Bokar service.', time: '16:30' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan via Mina sidor.', time: '10:00' }
      ]
    },
    '2024-0136': {
      id: '2024-0136',
      title: 'Spisplatta fungerar ej',
      description: 'En av de fyra spisplattorna på spisen har slutat fungera helt. Lampan tänds inte och plattan blir inte varm. Spisen är av märket Electrolux och ca 5 år gammal.',
      category: 'El',
      categoryIcon: 'zap',
      categoryClass: 'el',
      status: 'pending',
      statusText: 'Väntar',
      priority: 'medium',
      priorityText: 'Medium',
      address: 'Aspvägen 3',
      apartment: 'Lgh 102',
      tenant: {
        name: 'Olof Henriksson',
        initials: 'OH',
        email: 'olof.h@telia.se',
        phone: '070-789 01 23'
      },
      property: 'Centrum Fastigheter AB',
      createdAt: '2024-01-11 11:15',
      updatedAt: '2024-01-12 09:00',
      deadline: 120,
      assignedTo: 'Johan Berg',
      contractors: [
        { value: 'vitvaruservice', name: 'Vitvaruservice Stockholm' },
        { value: 'eljouren', name: 'Eljouren 24/7' }
      ],
      timeline: [
        { type: 'note', title: 'Intern anteckning', text: 'Kontrollerar om garanti fortfarande gäller.', time: '09:00' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan via telefon.', time: '11:15' }
      ]
    },
    '2024-0135': {
      id: '2024-0135',
      title: 'Kylskåp bullrar konstigt',
      description: 'Kylskåpet har börjat ge ifrån sig ett högt surrande/brummande ljud, speciellt på natten. Kylskåpet kyler fortfarande men ljudet är störande och hörs i hela lägenheten.',
      category: 'Vitvaror',
      categoryIcon: 'wrench',
      categoryClass: 'ovrigt',
      status: 'completed',
      statusText: 'Åtgärdad',
      priority: 'low',
      priorityText: 'Låg',
      address: 'Almvägen 18',
      apartment: 'Lgh 605',
      tenant: {
        name: 'Sara Pettersson',
        initials: 'SP',
        email: 'sara.p@live.se',
        phone: '076-890 12 34'
      },
      property: 'Bostadsbolaget Norr',
      createdAt: '2024-01-08 16:45',
      updatedAt: '2024-01-10 13:30',
      deadline: 0,
      assignedTo: 'Erik Svensson',
      contractors: [
        { value: 'vitvaruservice', name: 'Vitvaruservice Stockholm' },
        { value: 'kyl-frys', name: 'Kyl & Frys Experten' }
      ],
      timeline: [
        { type: 'closed', title: 'Ärende avslutat', text: 'Kompressorn justerad, ljudet har försvunnit.', time: '13:30' },
        { type: 'workorder', title: 'Arbetsorder skickad', text: 'Skickad till Vitvaruservice Stockholm.', time: '10:00' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan via email.', time: '16:45' }
      ]
    },
    '2024-0134': {
      id: '2024-0134',
      title: 'Fuktfläckar i tak',
      description: 'Det har uppstått brunaktiga fuktfläckar i taket i vardagsrummet. Fläckarna verkar växa och det finns risk att det droppar. Lägenheten ovanför har badrum på samma ställe.',
      category: 'VVS',
      categoryIcon: 'droplet',
      categoryClass: 'vvs',
      status: 'urgent',
      statusText: 'Brådskande',
      priority: 'high',
      priorityText: 'Hög',
      address: 'Kungsgatan 88',
      apartment: 'Lgh 302',
      tenant: {
        name: 'Anders Lindgren',
        initials: 'AL',
        email: 'anders.lindgren@företag.se',
        phone: '070-111 22 33'
      },
      property: 'Fastighetshuset Centrum AB',
      createdAt: '2024-01-15 07:00',
      updatedAt: '2024-01-15 09:30',
      deadline: 8,
      assignedTo: 'Maria Lindqvist',
      contractors: [
        { value: 'rorjouren', name: 'Rörjouren Stockholm AB' },
        { value: 'fuktskador', name: 'Fuktskador & Sanering AB' }
      ],
      timeline: [
        { type: 'note', title: 'Intern anteckning', text: 'Kontaktat grannen ovanför - de har haft problem med toaletten. Rörmokare på väg.', time: '09:30' },
        { type: 'message', title: 'Meddelande skickat', text: 'Hyresgäst informerad om akut insats.', time: '08:00' },
        { type: 'created', title: 'Ärende skapat', text: 'Akut felanmälan via telefon.', time: '07:00' }
      ]
    },
    '2024-0133': {
      id: '2024-0133',
      title: 'Ventilation fungerar dåligt',
      description: 'Det känns instängt i lägenheten och det luktar matos från köket som inte försvinner. Fläkten i badrummet verkar inte dra ordentligt. Hyresgästen har astma och påverkas av dålig luftkvalitet.',
      category: 'Ventilation',
      categoryIcon: 'wind',
      categoryClass: 'ovrigt',
      status: 'active',
      statusText: 'Pågående',
      priority: 'medium',
      priorityText: 'Medium',
      address: 'Vasagatan 55',
      apartment: 'Lgh 708',
      tenant: {
        name: 'Emma Karlsson',
        initials: 'EK',
        email: 'emma.k@gmail.com',
        phone: '073-222 33 44'
      },
      property: 'Fastighets AB Söder',
      createdAt: '2024-01-13 13:00',
      updatedAt: '2024-01-15 11:00',
      deadline: 48,
      assignedTo: 'Johan Berg',
      contractors: [
        { value: 'ventilation-ab', name: 'Ventilation AB Stockholm' },
        { value: 'luft-klimat', name: 'Luft & Klimat Service' }
      ],
      timeline: [
        { type: 'workorder', title: 'Arbetsorder skickad', text: 'Skickad till Ventilation AB Stockholm för OVK.', time: '11:00' },
        { type: 'note', title: 'Intern anteckning', text: 'Behöver troligtvis rensa ventilationskanaler.', time: '14:30' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan via Mina sidor.', time: '13:00' }
      ]
    },
    '2024-0132': {
      id: '2024-0132',
      title: 'Trasig tvättmaskin i tvättstugan',
      description: 'Tvättmaskin nr 3 i källarens tvättstuga stannar mitt i programmet. Den fylls med vatten men centrifugerar inte. Flera hyresgäster har klagat.',
      category: 'Gemensamma utrymmen',
      categoryIcon: 'home',
      categoryClass: 'ovrigt',
      status: 'pending',
      statusText: 'Väntar',
      priority: 'medium',
      priorityText: 'Medium',
      address: 'Storgatan 42',
      apartment: 'Gemensamt',
      tenant: {
        name: 'Felanmälan (gemensamt)',
        initials: 'GM',
        email: 'felanmalan@brf-storgatan.se',
        phone: '08-123 45 67'
      },
      property: 'BRF Storgatan 42',
      createdAt: '2024-01-14 08:00',
      updatedAt: '2024-01-14 10:30',
      deadline: 72,
      assignedTo: 'Erik Svensson',
      contractors: [
        { value: 'vitvaruservice', name: 'Vitvaruservice Stockholm' },
        { value: 'tvattstuge-service', name: 'Tvättstugeservice AB' }
      ],
      timeline: [
        { type: 'note', title: 'Intern anteckning', text: 'Satt upp lapp om att maskin 3 är ur funktion.', time: '10:30' },
        { type: 'created', title: 'Ärende skapat', text: 'Felanmälan från flera hyresgäster.', time: '08:00' }
      ]
    }
  };

  // Initialize icons
  lucide.createIcons();

  // Get current case data
  function getCurrentCase(id) {
    return casesDB[id] || casesDB['2024-0142']; // Default to first case
  }

  // Populate case detail view with data
  function populateCaseDetail(caseData) {
    // Update title and meta
    document.querySelector('#view-case h1[data-field="title"]').textContent = caseData.title;
    document.querySelectorAll('[data-field="id"]').forEach(el => el.textContent = '#' + caseData.id);
    document.querySelector('[data-field="category"]').textContent = caseData.category;
    document.querySelector('[data-field="tenant"]').textContent = caseData.tenant.name;
    document.querySelector('[data-field="address"]').textContent = caseData.address + ', ' + caseData.apartment;

    // Update status badge
    const statusBadge = document.querySelector('#view-case .status');
    statusBadge.className = 'status ' + caseData.status;
    statusBadge.innerHTML = '<span class="status-dot"></span>' + caseData.statusText;

    // Update priority
    const priorityEl = document.querySelector('#view-case .priority');
    priorityEl.className = 'priority ' + caseData.priority;
    priorityEl.textContent = caseData.priorityText;

    // Update tenant card
    document.querySelector('.tenant-card-avatar').textContent = caseData.tenant.initials;
    document.querySelector('.tenant-card-name').textContent = caseData.tenant.name;
    document.querySelector('.tenant-card-contact').textContent = caseData.tenant.email;

    // Update dates
    const infoRows = document.querySelectorAll('.info-row');
    infoRows.forEach(row => {
      const label = row.querySelector('.info-label')?.textContent;
      const valueEl = row.querySelector('.info-value');
      if (label === 'Skapad' && valueEl) valueEl.textContent = caseData.createdAt;
      if (label === 'Uppdaterad' && valueEl) valueEl.textContent = caseData.updatedAt;
      if (label === 'Telefon' && valueEl) valueEl.textContent = caseData.tenant.phone;
    });

    // Update contractor dropdown
    const contractorSelect = document.getElementById('entreprenor');
    contractorSelect.innerHTML = '<option value="">Välj entreprenör...</option>';
    caseData.contractors.forEach(c => {
      contractorSelect.innerHTML += `<option value="${c.value}">${c.name}</option>`;
    });

    // Update timeline
    const timeline = document.getElementById('timeline');
    timeline.innerHTML = '';
    caseData.timeline.forEach((item, index) => {
      const icons = {
        note: 'file-text',
        message: 'message-circle',
        workorder: 'hammer',
        closed: 'check-circle',
        created: 'plus-circle'
      };
      const markerClass = item.type === 'created' ? 'created' : item.type;

      timeline.innerHTML += `
        <div class="timeline-item">
          <div class="timeline-marker ${markerClass}">
            <i data-lucide="${icons[item.type] || 'circle'}" class="icon"></i>
          </div>
          <div class="timeline-content">
            <div class="timeline-header">
              <span class="timeline-title">${item.title}</span>
              <span class="timeline-time">${item.time}</span>
            </div>
            <div class="timeline-text">${item.text}</div>
          </div>
        </div>
      `;
    });

    // Store current case for form actions
    window.currentCase = caseData;
  }

  // Navigation
  function navigate(view, id = null) {
    // Update URL hash
    if (id) {
      window.location.hash = `${view}/${id}`;
    } else {
      window.location.hash = view;
    }
  }

  function showView(view, id = null) {
    // Hide all views
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

    // Update nav items
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.remove('active');
      if (item.dataset.view === view || (view === 'case' && item.dataset.view === 'cases')) {
        item.classList.add('active');
      }
    });

    // If showing a case, populate with data
    if (view === 'case' && id) {
      const caseData = getCurrentCase(id);
      populateCaseDetail(caseData);
    }

    // Show target view
    const targetView = document.getElementById(`view-${view}`);
    if (targetView) {
      targetView.classList.add('active');
      lucide.createIcons();
    }
  }

  // Handle hash changes
  function handleHashChange() {
    const hash = window.location.hash.slice(1) || 'dashboard';
    const [view, id] = hash.split('/');
    showView(view, id);
  }

  window.addEventListener('hashchange', handleHashChange);
  window.addEventListener('load', handleHashChange);

  // Toast notification
  function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    const toastIcon = document.getElementById('toast-icon');

    toast.className = 'toast ' + type;
    toastMessage.textContent = message;

    if (type === 'error') {
      toastIcon.setAttribute('data-lucide', 'alert-circle');
    } else if (type === 'info') {
      toastIcon.setAttribute('data-lucide', 'info');
    } else {
      toastIcon.setAttribute('data-lucide', 'check-circle');
    }

    lucide.createIcons();
    toast.classList.add('show');

    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000);
  }

  // Add to timeline
  function addToTimeline(title, content, type = 'note') {
    const timeline = document.getElementById('timeline');
    const now = new Date();
    const time = now.toLocaleTimeString('sv-SE', { hour: '2-digit', minute: '2-digit' });

    const icons = {
      note: 'file-text',
      message: 'message-circle',
      workorder: 'hammer',
      closed: 'check-circle'
    };

    const item = document.createElement('div');
    item.className = 'timeline-item';
    item.innerHTML = `
      <div class="timeline-marker ${type}">
        <i data-lucide="${icons[type]}" class="icon"></i>
      </div>
      <div class="timeline-content">
        <div class="timeline-header">
          <span class="timeline-title">${title}</span>
          <span class="timeline-time">${time}</span>
        </div>
        <div class="timeline-text">${content}</div>
      </div>
    `;

    timeline.insertBefore(item, timeline.firstChild);
    lucide.createIcons();
  }

  // Form actions
  function saveNote() {
    const note = document.getElementById('intern-anteckning').value;
    if (!note.trim()) {
      showToast('Skriv en anteckning först', 'error');
      return;
    }
    addToTimeline('Intern anteckning', note.substring(0, 80) + (note.length > 80 ? '...' : ''), 'note');
    document.getElementById('intern-anteckning').value = '';
    showToast('Anteckning sparad');
  }

  function sendReply() {
    const reply = document.getElementById('svar-hyresgast').value;
    if (!reply.trim()) {
      showToast('Skriv ett meddelande först', 'error');
      return;
    }
    addToTimeline('Meddelande skickat', 'Svar skickat till Anna Bergström', 'message');
    document.getElementById('svar-hyresgast').value = '';
    showToast('Meddelande skickat');
  }

  function sendWorkOrder() {
    const entreprenor = document.getElementById('entreprenor').value;
    const text = document.getElementById('arbetsorder').value;

    if (!entreprenor) {
      showToast('Välj en entreprenör', 'error');
      return;
    }
    if (!text.trim()) {
      showToast('Skriv en arbetsbeskrivning', 'error');
      return;
    }

    const names = {
      'rorjouren': 'Rörjouren Stockholm AB',
      'vvs-teknik': 'VVS-Teknik & Service',
      'akut-ror': 'Akut Rör & Värme AB'
    };

    addToTimeline('Arbetsorder skickad', 'Skickad till ' + names[entreprenor], 'workorder');
    document.getElementById('arbetsorder').value = '';
    document.getElementById('entreprenor').value = '';
    showToast('Arbetsorder skickad');
  }

  function closeCase() {
    const note = document.getElementById('slutnotering').value;
    if (!note.trim()) {
      showToast('Skriv en slutnotering först', 'error');
      return;
    }
    addToTimeline('Ärende avslutat', note.substring(0, 80) + (note.length > 80 ? '...' : ''), 'closed');
    document.getElementById('slutnotering').value = '';
    showToast('Ärendet har avslutats');
  }

  // Filter tabs
  document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      this.parentElement.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // Log for Rafter testing
  console.log('Pigello Demo - Single Page Application');
  console.log('Navigation: #dashboard, #cases, #case/2024-0142');
  console.log('Form fields for Rafter testing:');
  console.log('  #intern-anteckning - Internal notes');
  console.log('  #svar-hyresgast - Reply to tenant');
  console.log('  #arbetsorder - Work order');
  console.log('  #slutnotering - Closing note');
</script>
</body>
</html>
